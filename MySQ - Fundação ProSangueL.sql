
CREATE DATABASE FUNDACAO_PROSANGUE;
USE FUNDACAO_PROSANGUE;

CREATE TABLE TesteSangue (
IDTesteSangue INTEGER PRIMARY KEY AUTO_INCREMENT,
Nome VARCHAR(150),
ValorRef DECIMAL(5,2),
TipoSanguineo VARCHAR(2),
FatorRH CHAR(1),
Anticorpos VARCHAR(150) 
);

CREATE TABLE Doador (
IDDoador INTEGER PRIMARY KEY AUTO_INCREMENT,
NomePai VARCHAR(150) NOT NULL,
NomeMae VARCHAR(150) NOT NULL,
DataNascimento DATE NOT NULL,
Sexo CHAR(1) NOT NULL,
RG VARCHAR(9) NOT NULL,
Nome VARCHAR(150) NOT NULL,
Rua VARCHAR(150) NOT NULL,
Bairro VARCHAR(150) NOT NULL,
Cidade VARCHAR(150) NOT NULL,
Estado CHAR(2) NOT NULL,
NumeroResidencial VARCHAR(10) NOT NULL,
CEP CHAR(9) NOT NULL
);

CREATE TABLE Doacao (
IDDoacao INTEGER PRIMARY KEY AUTO_INCREMENT,
IDDoador INTEGER,
DataDoacao DATETIME NOT NULL,
QtdColetada DECIMAL(5,2) DEFAULT 0.00,
FOREIGN KEY(IDDoador) REFERENCES Doador (IDDoador) ON UPDATE RESTRICT ON DELETE RESTRICT
);

CREATE TABLE ExameSangue (
IDExameSangue INTEGER AUTO_INCREMENT,
IDDoacao INTEGER,
IDTesteSangue INTEGER,
Resultado VARCHAR(300) NOT NULL,
DataExameSangue DATETIME NOT NULL,
PRIMARY KEY(IDExameSangue,IDDoacao,IDTesteSangue),
FOREIGN KEY(IDTesteSangue) REFERENCES TesteSangue (IDTesteSangue) ON UPDATE RESTRICT ON DELETE RESTRICT,
FOREIGN KEY(IDDoacao) REFERENCES Doacao (IDDoacao) ON UPDATE RESTRICT ON DELETE RESTRICT
);

CREATE TABLE Medico (
IDMedico INTEGER PRIMARY KEY AUTO_INCREMENT,
Nome VARCHAR(150) NOT NULL,
CRM CHAR(6) NOT NULL,
EstadoCRM CHAR(2) NOT NULL
);

CREATE TABLE Exames (
IDExames INTEGER PRIMARY KEY AUTO_INCREMENT,
Pergunta VARCHAR(300),
NvlRefHemoglobina DECIMAL(5,2)
);

CREATE TABLE Avaliacao (
IDAvaliacao INTEGER PRIMARY KEY AUTO_INCREMENT,
IDDoador INTEGER,
DataAvaliacao DATETIME NOT NULL,
ResultadoGeral BOOL,
FOREIGN KEY(IDDoador) REFERENCES Doador (IDDoador) ON UPDATE RESTRICT ON DELETE RESTRICT
);

CREATE TABLE CandExame (
IDExames INTEGER,
IDAvaliacao INTEGER,
Resultado VARCHAR(300) NOT NULL,
DataExame DATETIME NOT NULL,
PRIMARY KEY(IDExames,IDAvaliacao),
FOREIGN KEY(IDExames) REFERENCES Exames (IDExames) ON UPDATE RESTRICT ON DELETE RESTRICT,
FOREIGN KEY(IDAvaliacao) REFERENCES Avaliacao (IDAvaliacao) ON UPDATE RESTRICT ON DELETE RESTRICT
);

CREATE TABLE Consulta (
IDConsulta INTEGER AUTO_INCREMENT,
IDMedico INTEGER,
IDExameSangue INTEGER,
IDDoacao INTEGER,
IDTesteSangue INTEGER,
DataConsulta DATETIME NOT NULL,
PRIMARY KEY(IDConsulta,IDMedico,IDExameSangue,IDDoacao,IDTesteSangue),
FOREIGN KEY(IDExameSangue,IDDoacao,IDTesteSangue)
REFERENCES ExameSangue (IDExameSangue,IDDoacao,IDTesteSangue) ON UPDATE RESTRICT ON DELETE RESTRICT,
FOREIGN KEY(IDMedico) REFERENCES Medico (IDMedico) ON UPDATE RESTRICT ON DELETE RESTRICT
);


/* CRIANDO INDEX */
CREATE INDEX IDX_DoadorRG on Doador(RG);
CREATE INDEX IDX_DATADOACAO ON Doacao(DataDoacao);
CREATE INDEX IDX_MedicoCRM on Medico(CRM);
CREATE INDEX IDX_MedicoESTADOCRM on Medico(ESTADOCRM);
CREATE INDEX IDX_DATAAVALIACAO ON AVALIACAO(DATAAVALIACAO);
CREATE INDEX IDX_RESULTADOAVALIACAO ON AVALIACAO(RESULTADOGERAL);
CREATE INDEX IDX_DATACONSULTA ON CONSULTA(DATACONSULTA);
CREATE INDEX IDX_DATAEXAME ON CANDEXAME(DATAEXAME);
CREATE INDEX IDX_DATAEXAMESANGUE ON EXAMESANGUE(DATAEXAMESANGUE);

