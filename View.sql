

CREATE VIEW ULTIMADOACAO_TIPOSANGUINEO(DOADOR, TIPOSANGUINEO, FATORRH, ULTDOACAO)
AS
SELECT DR.NOME, T.TIPOSANGUINEO, T.FATORRH, MAX(D.DATADOACAO) 
FROM DOADOR AS DR, EXAMESANGUE AS E, DOACAO AS D, TESTESANGUE AS T
WHERE TIPOSANGUINEO IS NOT NULL AND
FATORRH IS NOT NULL AND 
DR.IDDOADOR = D.IDDOADOR AND
D.IDDOACAO = E.IDDOACAO AND
T.IDTESTESANGUE = E.IDTESTESANGUE
GROUP BY DR.IDDOADOR
ORDER BY T.TIPOSANGUINEO, 4;


CREATE VIEW COUNT_TIPOSANGUNEO (TIPOSANGUINEO, NUMERODOACOES)
AS
SELECT TIPOSANGUINEO, COUNT(*) 
FROM TESTESANGUE AS T, DOACAO AS D, EXAMESANGUE AS E 
WHERE TIPOSANGUINEO IS NOT NULL AND 
CAST(DATADOACAO AS DATE) >= DATE_SUB(CURDATE(), INTERVAL 5 YEAR) AND 
E.IDDOACAO = D.IDDOACAO AND T.IDTESTESANGUE = E.IDTESTESANGUE
GROUP BY TIPOSANGUINEO
ORDER BY COUNT(*);
